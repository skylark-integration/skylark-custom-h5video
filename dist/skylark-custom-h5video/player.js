/**
 * skylark-custom-h5video - A version of custom-html5-vedio that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx","skylark-domx-styler","skylark-domx-noder","skylark-domx-eventer","skylark-domx-query","skylark-domx-plugins-base"],function(t,e,i,s,o,n){"use strict";var l=n.Plugin.inherit({klassName:"CustomHtml5Video",pluginName:"intg.custom_html5_video",options:{selectors:{video:"video",videoControls:".video-controls",playButton:".play",playbackIcons:".playback-icons use",timeElapsed:".time-elapsed",duration:".duration",progressBar:".progress-bar",seek:".seek",seekTooltip:".seek-tooltip",volumeButton:".volume-button",volumeIcons:".volume-button use",volumeMute:'use[href="#volume-mute"]',volumeLow:'use[href="#volume-low"]',volumeHigh:'use[href="#volume-high"]',volume:".volume",playbackAnimation:".playback-animation",fullscreenButton:".fullscreen-button",fullscreenIcons:".fullscreen-button use",pipButton:".pip-button"}},_construct:function(t,e){n.Plugin.prototype._construct.call(this,t,e);let i=this.$(),s=this.options.selectors;this._video=i.find(s.video)[0],this._videoControls=i.find(s.videoControls)[0],this._playButton=i.find(s.playButton)[0],this._playbackIcons=i.find(s.playbackIcons),this._timeElapsed=i.find(s.timeElapsed)[0],this._duration=i.find(s.duration)[0],this._progressBar=i.find(s.progressBar)[0],this._seek=i.find(s.seek)[0],this._seekTooltip=i.find(s.seekTooltip)[0],this._volumeButton=i.find(s.volumeButton)[0],this._volumeIcons=i.find(s.volumeIcons),this._volumeMute=i.find(s.volumeMute)[0],this._volumeLow=i.find(s.volumeLow)[0],this._volumeHigh=i.find(s.volumeHigh)[0],this._volume=i.find(s.volume)[0],this._playbackAnimation=i.find(s.playbackAnimation)[0],this._fullscreenButton=i.find(s.fullscreenButton)[0],this._fullscreenIcons=i.find(s.fullscreenIcons),this._pipButton=i.find(s.pipButton)[0],this.listenTo(o(this._playButton),"click",this.togglePlay),this.listenTo(o(this._video),"play",this.updatePlayButton),this.listenTo(o(this._video),"pause",this.updatePlayButton),this.listenTo(o(this._video),"loadedmetadata",this.initializeVideo),this.listenTo(o(this._video),"timeupdate",this.updateTimeElapsed),this.listenTo(o(this._video),"timeupdate",this.updateProgress),this.listenTo(o(this._video),"volumechange",this.updateVolumeIcon),this.listenTo(o(this._video),"click",this.togglePlay),this.listenTo(o(this._video),"click",this.animatePlayback),this.listenTo(o(this._video),"mouseenter",this.showControls),this.listenTo(o(this._video),"mouseleave",this.hideControls),this.listenTo(o(this._videoControls),"mouseenter",this.showControls),this.listenTo(o(this._videoControls),"mouseleave",this.hideControls),this.listenTo(o(this._seek),"mousemove",this.updateSeekTooltip),this.listenTo(o(this._seek),"input",this.skipAhead),this.listenTo(o(this._volume),"input",this.updateVolume),this.listenTo(o(this._volumeButton),"click",this.toggleMute),this.listenTo(o(this._fullscreenButton),"click",this.toggleFullScreen),this.listenTo(i,"fullscreenchange",this.updateFullscreenButton),this.listenTo(o(this._pipButton),"click",this.togglePip),"pictureInPictureEnabled"in document||this._pipButton.classList.add("hidden"),this.listenTo(o(document),"keyup",this.keyboardShortcuts),!!document.createElement("video").canPlayType&&(this._video.controls=!1,this._videoControls.classList.remove("hidden")),this.load()},source:function(t){this._media=t;let e=t.title||"",i=t.href,s=t.type,o=t.poster||"",n=t.altText||"",l=this.$(),u=this._video,a=this._$play,h=this._$poster;l.prop("title",e),u.canPlayType&&i&&s&&u.canPlayType(s)&&(u.src=i),u.poster=o,h.prop({src:o,alt:n}),a.prop({download:e,href:i})},load:function(){this._video.load()},play:function(){this._video.play()},stop:function(){},pause:function(){this._video.pause()},togglePlay:function(){this._video.paused||this._video.ended?this._video.play():this._video.pause()},updatePlayButton:function(){this._playbackIcons.forEach(t=>t.classList.toggle("hidden")),video.paused?this._playButton.setAttribute("data-title","Play (k)"):this._playButton.setAttribute("data-title","Pause (k)")},formatTime:function(t){const e=new Date(1e3*t).toISOString().substr(11,8);return{minutes:e.substr(3,2),seconds:e.substr(6,2)}},initializeVideo:function(){const t=Math.round(this._video.duration);this._seek.setAttribute("max",t),this._progressBar.setAttribute("max",t);const e=this.formatTime(t);this._duration.innerText=`${e.minutes}:${e.seconds}`,this._duration.setAttribute("datetime",`${e.minutes}m ${e.seconds}s`)},updateTimeElapsed:function(){const t=this.formatTime(Math.round(this._video.currentTime));this._timeElapsed.innerText=`${t.minutes}:${t.seconds}`,this._timeElapsed.setAttribute("datetime",`${t.minutes}m ${t.seconds}s`)},updateProgress:function(){this._seek.value=Math.floor(this._video.currentTime),this._progressBar.value=Math.floor(this._video.currentTime)},updateSeekTooltip:function(t){const e=Math.round(t.offsetX/t.target.clientWidth*parseInt(t.target.getAttribute("max"),10));this._seek.setAttribute("data-seek",e);const i=this.formatTime(e);this._seekTooltip.textContent=`${i.minutes}:${i.seconds}`;const s=this._video.getBoundingClientRect();this._seekTooltip.style.left=`${t.pageX-s.left}px`},skipAhead:function(t){const e=t.target.dataset.seek?t.target.dataset.seek:t.target.value;this._video.currentTime=e,this._progressBar.value=e,this._seek.value=e},updateVolume:function(){this._video.muted&&(this._video.muted=!1),this._video.volume=this._volume.value},updateVolumeIcon:function(){this._volumeIcons.forEach(t=>{t.classList.add("hidden")}),this._volumeButton.setAttribute("data-title","Mute (m)"),this._video.muted||0===this._video.volume?(this._volumeMute.classList.remove("hidden"),this._volumeButton.setAttribute("data-title","Unmute (m)")):this._video.volume>0&&this._video.volume<=.5?this._volumeLow.classList.remove("hidden"):this._volumeHigh.classList.remove("hidden")},toggleMute:function(){this._video.muted=!video.muted,this._video.muted?(this._volume.setAttribute("data-volume",this._volume.value),this._volume.value=0):this._volume.value=this._volume.dataset.volume},animatePlayback:function(){this._playbackAnimation.animate([{opacity:1,transform:"scale(1)"},{opacity:0,transform:"scale(1.3)"}],{duration:500})},toggleFullScreen:function(){document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():this._elm.webkitRequestFullscreen?this._elm.webkitRequestFullscreen():this._elm.requestFullscreen()},updateFullscreenButton:function(){fullscreenIcons.forEach(t=>t.classList.toggle("hidden")),document.fullscreenElement?fullscreenButton.setAttribute("data-title","Exit full screen (f)"):fullscreenButton.setAttribute("data-title","Full screen (f)")},togglePip:function(){try{this._video!==document.pictureInPictureElement?(this._pipButton.disabled=!0,this._video.requestPictureInPicture()):document.exitPictureInPicture()}catch(t){console.error(t)}finally{this._pipButton.disabled=!1}},hideControls:function(){this._video.paused||e.addClass(this._videoControls,"hide")},showControls:function(){e.removeClass(this._videoControls,"hide")},keyboardShortcuts:function(t){const{key:e}=t;switch(e){case"k":this.togglePlay(),this.animatePlayback(),this._video.paused?this.showControls():setTimeout(()=>{this.hideControls()},2e3);break;case"m":this.toggleMute();break;case"f":this.toggleFullScreen();break;case"p":this.togglePip()}}});return n.register(l),l});
//# sourceMappingURL=sourcemaps/player.js.map
